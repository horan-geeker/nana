version: "2.1"
services:
    openresty:
        build: .
        image: openresty-nana:0.1
        volumes:
            - "./:/var/www/nana"
            - "./docker/nginx/conf/nginx.conf.raw:/usr/local/openresty/nginx/conf/nginx.conf.raw"
            - "./docker/nginx/logs:/usr/local/openresty/nginx/logs"
        ports:
            - 8880:80
            - 4430:443
        env_file: .env
        networks:
            default:
        command: /bin/bash -c "envsubst '$$API_SERVER_NAME' < /usr/local/openresty/nginx/conf/nginx.conf.raw | envsubst '$$PROXY_PASS_URL' > /usr/local/openresty/nginx/conf/nginx.conf && nginx -g 'daemon off;'"
networks:
    default: